import{r,i as x,w as _e,e as Ce,c as i,k as S,l as ke,F as G,E as c,j as Q,o as a,a as e,T as U,D as u,b as _,z as m,q as H,x as F,Y as ee,C as te,Q as Te}from"./index-3TT_0WAL.js";import{r as De,u as Ve}from"./xlsx-uoQkVabA.js";import{u as Se}from"./question.store-swwE8Fd0.js";const Qe={class:"max-w-6xl mx-auto p-6"},Ue={class:"mb-6"},Fe={class:"flex justify-between items-center"},je={class:"relative w-64"},qe={class:"mb-6"},$e={class:"flex justify-between items-center"},Ie={class:"flex space-x-2"},Le=["disabled"],Ee={key:0,class:"bg-white rounded-lg shadow-lg p-6"},Be={class:"flex justify-between items-center mb-6"},Ge={class:"relative w-64"},Me={key:0,class:"py-8 text-center"},Ne={key:1},Ae={class:"flex justify-between items-center mb-4"},Pe={class:"flex items-center space-x-4"},ze={class:"flex space-x-2"},He=["onClick"],Ke={class:"flex items-center space-x-2"},Re={class:"overflow-x-auto"},We={class:"min-w-full"},Oe={class:"bg-white divide-y divide-gray-200"},Ye={class:"px-6 py-4"},Je={class:"px-6 py-4 capitalize"},Xe={class:"px-6 py-4"},Ze={class:"px-6 py-4"},et={class:"flex space-x-2"},tt=["onClick","disabled"],st=["onClick","disabled"],lt={class:"flex items-center justify-between mt-4 px-6 py-3 bg-gray-50 border-t"},ot={class:"flex items-center"},nt={class:"text-sm text-gray-700"},it={class:"flex items-center space-x-2"},at=["disabled"],rt={class:"text-sm text-gray-700"},ut=["disabled"],dt={key:1,class:"bg-white rounded-lg shadow-lg p-6"},ct={class:"text-2xl font-semibold mb-6"},pt={class:"space-y-6"},bt=["disabled"],vt=["disabled"],gt={class:"space-y-4"},ft=["onUpdate:modelValue","placeholder","disabled"],xt=["onClick","disabled"],mt={class:"flex items-center space-x-2 mt-2"},yt=["onUpdate:modelValue","disabled"],ht=["disabled"],wt={class:"flex space-x-4"},_t=["disabled"],Ct={key:0,class:"flex items-center justify-center"},kt={key:1},Tt=["disabled"],Dt={key:0,class:"flex items-center justify-center"},Vt={key:1},St=["disabled"],Qt={key:2,class:"bg-white rounded-lg shadow-lg p-6"},Ut={class:"space-y-8 p-6 bg-white shadow-lg rounded-lg"},Ft={class:"relative"},jt=["disabled"],qt={key:0,class:"mt-6 bg-gray-50 p-4 rounded-lg shadow"},$t={class:"text-sm text-gray-700"},It={class:"text-sm text-gray-700 mt-2"},Lt=["disabled"],Nt={__name:"InstructorQuestions",setup(Et){const y=Se(),g=r(null),M=r(null),j=r(null),d=r("list"),N=r(""),K=r([]),R=r([]),W=r([]),h=r(!1),o=r(!1),C=r(!1),p=r(1),k=r(5),T=r("all"),se={all:"Tất cả",easy:"Dễ",medium:"Trung bình",hard:"Khó"},O={all:{active:"bg-gray-800 text-white",inactive:"bg-gray-100 text-gray-800 hover:bg-gray-200"},easy:{active:"bg-green-600 text-white",inactive:"bg-green-100 text-green-800 hover:bg-green-200"},medium:{active:"bg-yellow-600 text-white",inactive:"bg-yellow-100 text-yellow-800 hover:bg-yellow-200"},hard:{active:"bg-red-600 text-white",inactive:"bg-red-100 text-red-800 hover:bg-red-200"}},n=r({question:"",options:[{option:"",isCorrect:!1},{option:"",isCorrect:!1}],difficulty:"easy"}),q=x(()=>W.value.filter(s=>s.question.toLowerCase().includes(N.value.toLowerCase()))),Y=x(()=>n.value.question.trim()!==""&&n.value.options.length>=2&&n.value.options.every(s=>s.option.trim()!=="")&&n.value.options.some(s=>s.isCorrect));function $(s){o.value||(d.value=s),d.value==="list"&&(g.value="",f())}function le(s){return{easy:"bg-green-100 text-green-800",medium:"bg-yellow-100 text-yellow-800",hard:"bg-red-100 text-red-800"}[s]||""}function oe(){n.value.options.length<6&&n.value.options.push({option:"",isCorrect:!1})}function ne(s){n.value.options.length>2&&n.value.options.splice(s,1)}function ie(s){C.value=!0,j.value=s}async function ae(){if(!j.value)return;o.value=!0,(await y.handleDeleteQuestion(j.value._id)).errors?c({text:"errors",type:"error"}):(c({text:"Delete Success",type:"success"}),o.value=!1,C.value=!1,f())}function re(){C.value=!1,j.value._id=null}function I(){n.value={question:"",options:[{option:"",isCorrect:!1},{option:"",isCorrect:!1}],difficulty:"easy"},h.value=!1,M.value=null,d.value="list"}function ue(s){h.value=!0,M.value=s._id,console.log(s),n.value={question:s.question,options:s.options.map(t=>({option:t.option,isCorrect:t.isCorrect})),difficulty:s.difficulty},d.value="form"}async function de(){const s={...n.value,question_id:M.value};(await y.handleUpdateQuestion(s)).errors?c({text:"errors",type:"error"}):(c({text:"Update Success",type:"success"}),I(),f())}async function ce(){o.value=!0;const s=await y.handleCreateQuestion(g.value,n.value);o.value=!1,s.errors?c({text:"errors",type:"error"}):(c({text:"Create Success",type:"success"}),I(),f())}async function pe(){o.value=!0;const s=await y.handleGetCourseById();o.value=!1,s.errors?c({text:"errors",type:"error"}):K.value=s}function be(s){g.value=s.value,d.value==="list"&&f()}async function f(){o.value=!0;const s=await y.handleGetQuestion(g.value);o.value=!1,s.errors?c({text:"errors",type:"error"}):W.value=s.data}function ve(s){const t=new FileReader;return new Promise((b,P)=>{t.onload=D=>{const z=D.target.result,E=De(z,{type:"binary"}),l=E.SheetNames[0],v=E.Sheets[l],w=Ve.sheet_to_json(v),Z=[],B={};w.forEach(me=>{const{question:V,option:ye,isCorrect:he,difficulty:we}=me;B[V]||(B[V]={question:V,options:[],difficulty:we},Z.push(B[V])),B[V].options.push({option:ye,isCorrect:he===!0})}),b(Z)},t.onerror=D=>P(D),t.readAsBinaryString(s)})}function ge(s){const t=s.target.files[0];t&&(t.name.endsWith(".xlsx")||t.name.endsWith(".xls"))?ve(t).then(b=>{R.value=b,console.log(b)}).catch(b=>{console.error("File parsing error:",b)}):c({text:"Vui lòng tải lên tệp Excel hợp lệ (.xlsx, .xls).",type:"error"})}async function fe(){const s={course_id:g.value,list_question:R.value};(await y.handleCreateQuestions(s)).errors?c({text:"errors",type:"error"}):(c({text:"Create Success",type:"success"}),I(),f())}const L=x(()=>T.value==="all"?q.value:q.value.filter(s=>s.difficulty===T.value)),J=x(()=>Math.ceil(L.value.length/k.value)),A=x(()=>(p.value-1)*k.value),X=x(()=>Math.min(A.value+k.value,L.value.length)),xe=x(()=>L.value.slice(A.value,X.value));return _e([q,T],()=>{p.value=1}),Ce(async()=>{pe(),f()}),(s,t)=>{const b=Q("GenericSelect"),P=Q("GenericInput"),D=Q("ConfirmDialog"),z=Q("InstructorLayout"),E=Q("FullScreenLoading");return a(),i(G,null,[S(z,null,{default:ke(()=>[e("div",Qe,[e("div",Ue,[e("div",Fe,[e("div",je,[t[13]||(t[13]=e("label",{for:"course",class:"block text-sm font-medium text-gray-700 mb-1"},"Chọn khóa học",-1)),S(b,{id:"course",modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=l=>g.value=l),onChange:be,options:K.value,class:"w-full border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:o.value},null,8,["modelValue","options","disabled"])])])]),e("div",qe,[e("div",$e,[e("div",Ie,[e("button",{onClick:t[1]||(t[1]=l=>$("list")),class:U(["px-4 py-2 rounded-lg transition-colors",d.value==="list"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," Danh sách câu hỏi ",2),e("button",{onClick:t[2]||(t[2]=l=>$("form")),class:U(["px-4 py-2 rounded-lg transition-colors",d.value==="form"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},u(h.value?"Chỉnh sửa câu hỏi":"Thêm câu hỏi mới"),3),e("button",{onClick:t[3]||(t[3]=l=>$("bulk")),class:U(["px-4 py-2 rounded-lg transition-colors",d.value==="bulk"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," Thêm nhiều câu hỏi ",2)]),d.value==="list"?(a(),i("button",{key:0,onClick:t[4]||(t[4]=l=>$("form")),class:"flex items-center px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",disabled:o.value},t[14]||(t[14]=[e("i",{class:"bi bi-plus text-lg mr-2"},null,-1),_(" Thêm câu hỏi ")]),8,Le)):m("",!0)])]),d.value==="list"?(a(),i("div",Ee,[e("div",Be,[t[16]||(t[16]=e("h2",{class:"text-2xl font-semibold"},"Danh sách câu hỏi",-1)),e("div",Ge,[t[15]||(t[15]=e("i",{class:"bi bi-search absolute left-3 top-2.5 text-gray-500"},null,-1)),S(P,{modelValue:N.value,"onUpdate:modelValue":t[5]||(t[5]=l=>N.value=l),type:"text",placeholder:"Tìm kiếm câu hỏi...",class:"w-full pl-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,["modelValue"])])]),q.value.length?(a(),i("div",Ne,[e("div",Ae,[e("div",Pe,[t[18]||(t[18]=e("span",{class:"text-sm font-medium text-gray-700"},"Chọn độ khó:",-1)),e("div",ze,[(a(),i(G,null,H(["all","easy","medium","hard"],l=>e("button",{key:l,onClick:v=>T.value=l,class:U(["px-3 py-1.5 rounded-lg text-sm font-medium transition-colors",T.value===l?O[l].active:O[l].inactive])},u(se[l]),11,He)),64))])]),e("div",Ke,[t[20]||(t[20]=e("span",{class:"text-sm text-gray-600"},"Hiển thị:",-1)),F(e("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>k.value=l),class:"border rounded-md px-2 py-1 text-sm",onChange:t[7]||(t[7]=l=>p.value=1)},t[19]||(t[19]=[e("option",{value:5},"5",-1),e("option",{value:10},"10",-1),e("option",{value:20},"20",-1)]),544),[[ee,k.value]])])]),e("div",Re,[e("table",We,[t[23]||(t[23]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Câu hỏi "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Độ khó"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Số câu trả lời "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Thao tác ")])],-1)),e("tbody",Oe,[(a(!0),i(G,null,H(xe.value,l=>(a(),i("tr",{key:l.id,class:"hover:bg-gray-50"},[e("td",Ye,u(l.question),1),e("td",Je,[e("span",{class:U(["px-2 py-1 rounded-full text-sm",le(l.difficulty)])},u(l.difficulty),3)]),e("td",Xe,u(l.options.length),1),e("td",Ze,[e("div",et,[e("button",{onClick:v=>ue(l),class:"p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors",disabled:o.value},t[21]||(t[21]=[e("i",{class:"bi bi-pencil"},null,-1)]),8,tt),e("button",{onClick:v=>ie(l),class:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors",disabled:o.value},t[22]||(t[22]=[e("i",{class:"bi bi-trash"},null,-1)]),8,st)])])]))),128))])])]),e("div",lt,[e("div",ot,[e("span",nt," Hiển thị "+u(A.value+1)+"-"+u(X.value)+" trong tổng số "+u(L.value.length)+" mục ",1)]),e("div",it,[e("button",{onClick:t[8]||(t[8]=l=>p.value--),disabled:p.value===1,class:"px-3 py-1 rounded bg-white border hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},t[24]||(t[24]=[e("i",{class:"bi bi-chevron-left"},null,-1)]),8,at),e("span",rt,"Trang "+u(p.value)+" / "+u(J.value),1),e("button",{onClick:t[9]||(t[9]=l=>p.value++),disabled:p.value===J.value,class:"px-3 py-1 rounded bg-white border hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"},t[25]||(t[25]=[e("i",{class:"bi bi-chevron-right"},null,-1)]),8,ut)])])])):(a(),i("div",Me,t[17]||(t[17]=[e("i",{class:"bi bi-inbox text-4xl text-gray-400"},null,-1),e("p",{class:"mt-2 text-gray-600"},"Vui lòng chọn khóa học",-1)])))])):m("",!0),d.value==="form"?(a(),i("div",dt,[e("h2",ct,u(h.value?"Chỉnh sửa câu hỏi":"Thêm câu hỏi mới"),1),e("div",pt,[e("div",null,[t[26]||(t[26]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Câu hỏi",-1)),F(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=l=>n.value.question=l),rows:"4",class:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:"",disabled:o.value},null,8,bt),[[te,n.value.question]])]),e("div",null,[t[28]||(t[28]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Độ khó",-1)),F(e("select",{"onUpdate:modelValue":t[11]||(t[11]=l=>n.value.difficulty=l),class:"w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",required:"",disabled:o.value},t[27]||(t[27]=[e("option",{value:"easy"},"Dễ",-1),e("option",{value:"medium"},"Trung bình",-1),e("option",{value:"hard"},"Khó",-1)]),8,vt),[[ee,n.value.difficulty]])]),e("div",gt,[t[31]||(t[31]=e("div",{class:"flex justify-between items-center"},[e("label",{class:"block text-sm font-medium text-gray-700"},"Câu trả lời"),e("span",{class:"text-sm text-gray-500"}," Tối thiểu 2 câu trả lời, tối đa 6 câu trả lời ")],-1)),(a(!0),i(G,null,H(n.value.options,(l,v)=>(a(),i("div",{key:v,class:"relative"},[F(e("textarea",{"onUpdate:modelValue":w=>l.option=w,class:"w-full p-2 pr-8 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:`Câu trả lời ${v+1}`,required:"",disabled:o.value},null,8,ft),[[te,l.option]]),e("button",{type:"button",onClick:w=>ne(v),class:"absolute right-2 top-2 text-gray-400 hover:text-red-500",disabled:n.value.options.length<=2||o.value},t[29]||(t[29]=[e("i",{class:"bi bi-x-lg"},null,-1)]),8,xt),e("label",mt,[F(e("input",{type:"checkbox","onUpdate:modelValue":w=>l.isCorrect=w,class:"rounded text-blue-500 focus:ring-blue-500",disabled:o.value},null,8,yt),[[Te,l.isCorrect]]),t[30]||(t[30]=e("span",{class:"text-sm text-gray-600"},"Đáp án đúng",-1))])]))),128))]),e("button",{type:"button",onClick:oe,class:"w-full px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors flex items-center justify-center",disabled:n.value.options.length>=6||o.value},t[32]||(t[32]=[e("i",{class:"bi bi-plus text-lg mr-2"},null,-1),_(" Thêm câu trả lời ")]),8,ht),e("div",wt,[h.value?m("",!0):(a(),i("button",{key:0,onClick:ce,type:"submit",class:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50",disabled:o.value||!Y.value},[o.value?(a(),i("span",Ct,t[33]||(t[33]=[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"},null,-1),_(" Đang xử lý... ")]))):(a(),i("span",kt," Tạo câu hỏi "))],8,_t)),h.value?(a(),i("button",{key:1,onClick:de,type:"submit",class:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50",disabled:o.value||!Y.value},[o.value?(a(),i("span",Dt,t[34]||(t[34]=[e("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"},null,-1),_(" Đang xử lý... ")]))):(a(),i("span",Vt," Cập nhật "))],8,Tt)):m("",!0),e("button",{type:"button",onClick:I,class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:o.value}," Hủy ",8,St)])])])):m("",!0),d.value==="bulk"?(a(),i("div",Qt,[t[38]||(t[38]=e("h2",{class:"text-2xl font-semibold mb-6"},"Tạo nhiều câu hỏi từ Excel",-1)),e("div",Ut,[e("div",Ft,[t[35]||(t[35]=e("label",{for:"excel-file",class:"block text-sm font-medium text-gray-800 mb-2"},"Tải tệp Excel lên",-1)),e("input",{type:"file",id:"excel-file",accept:".xlsx,.xls",onChange:ge,class:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition",disabled:o.value},null,40,jt)]),s.uploadedFile?(a(),i("div",qt,[e("p",$t,[t[36]||(t[36]=e("span",{class:"font-semibold"},"Tệp đã tải lên:",-1)),_(" "+u(s.uploadedFile.name),1)]),e("p",It,[t[37]||(t[37]=e("span",{class:"font-semibold"},"Số câu hỏi trong tệp:",-1)),_(" "+u(s.questionsFromFile.length),1)])])):m("",!0),e("button",{onClick:fe,class:"w-full px-5 py-3 bg-green-600 text-white font-medium rounded-lg shadow-md hover:bg-green-700 focus:ring-2 focus:ring-green-500 transition-colors",disabled:o.value}," Tạo danh sách câu hỏi ",8,Lt)])])):m("",!0),S(D,{modelValue:C.value,"onUpdate:modelValue":t[12]||(t[12]=l=>C.value=l),onAccept:ae,onDeny:re},null,8,["modelValue"])])]),_:1}),S(E,{open:o.value},null,8,["open"])],64)}}};export{Nt as default};
