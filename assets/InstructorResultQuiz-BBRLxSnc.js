import{r as h,i as k,e as O,c as n,k as y,l as P,F as C,E as B,j as b,o as u,a as e,T as S,b as x,z as v,q as T,D as r}from"./index-DYsdoSjd.js";import{u as K}from"./course.store-Cjcc_Qsw.js";import{u as H}from"./question.store-CDTz2pud.js";const J={class:"max-w-6xl mx-auto p-6"},W={class:"mb-6"},X={class:"flex justify-between items-center"},Y={class:"relative w-64"},Z={class:"mb-6"},ee={class:"flex justify-between items-center"},te={class:"flex space-x-2"},se=["disabled"],le={key:0,class:"bg-white rounded-lg shadow-lg p-6"},ae={class:"flex justify-between items-center mb-6"},oe={class:"relative w-64"},ie={key:0,class:"py-8 text-center"},re={key:1},ne={class:"overflow-x-auto"},ue={class:"min-w-full"},ce={class:"bg-white divide-y divide-gray-200"},de={class:"px-6 py-4"},pe={class:"px-6 py-4"},xe={class:"px-6 py-4"},ge={class:"px-6 py-4"},me={class:"px-6 py-4"},he={class:"px-6 py-4"},ye={key:1,class:"bg-white rounded-lg shadow-lg p-6"},fe={class:"flex justify-between items-center mb-6"},be={class:"flex space-x-4"},ve={class:"relative w-64"},we={class:"relative w-64"},_e={class:"relative"},ke={key:0,class:"py-8 text-center"},Ce={key:1,class:"overflow-x-auto"},Se={class:"min-w-full"},Te={class:"bg-white divide-y divide-gray-200"},Ve={class:"px-6 py-4"},Ae={class:"flex items-center"},Qe={class:"px-6 py-4"},De={class:"px-6 py-4"},Ne={class:"px-6 py-4"},Fe={class:"px-6 py-4"},Ie={class:"px-6 py-4"},Le={class:"px-6 py-4"},Ge={class:"px-6 py-4"},je={key:2,class:"py-8 text-center"},qe={key:2,class:"bg-white rounded-lg shadow-lg p-6"},Be={class:"flex justify-between items-center mb-6"},Re={class:"relative w-64"},$e={class:"overflow-x-auto"},Ue={class:"min-w-full divide-y divide-gray-200"},ze={class:"bg-white divide-y divide-gray-200"},Ee={class:"px-6 py-4 whitespace-nowrap"},Me={class:"flex items-center"},Oe={class:"font-medium"},Pe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ke={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},He={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Je={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},We={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Xe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ye={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ze={key:0,class:"text-center py-8"},at={__name:"InstructorResultQuiz",setup(et){const R=K(),$=H(),w=h(null),d=h(null),g=h("list"),f=h(""),V=h([]),p=h([]),m=h(!1),A=h(!1);function _(a){m.value||(g.value=a)}async function U(){m.value=!0;const a=await $.handleGetCourseById();m.value=!1,a.errors?B({text:"errors",type:"error"}):V.value=a}function z(a){w.value=a.value,d.value=null,Q()}async function Q(){var i,s;const a={course_id:w.value},t=await R.handleGetResultForTeacher(a);t.errors?B({text:t.errors,type:"error"}):(p.value=(i=t.data)==null?void 0:i.stats,((s=p.value)==null?void 0:s.length)>0&&(d.value=p.value[0].questionSet_id))}const D=k(()=>{if(!d.value||!p.value)return[];const a=p.value.find(s=>s.questionSet_id===d.value);if(!a)return[];const t={},i={roomName:"Chưa phân phòng",users:[],totalAttempts:0,averageScore:0,highestScore:0,averageTimeTaken:0,totalCorrectAnswers:0,totalQuestions:0,passCount:0};return a.submissions.forEach(s=>{const o=s.room,c={userId:s.userId,fullName:s.fullName,attempts:s.attemptCount,score:s.highestScore,timeTaken:s.timeTaken,correctAnswers:s.countCorrected,totalQuestions:s.totalAnswers,isPassed:s.highestScore>=70};o?(t[o]||(t[o]={roomId:o,roomName:`${o}`,users:[],totalAttempts:0,averageScore:0,highestScore:0,averageTimeTaken:0,totalCorrectAnswers:0,totalQuestions:0,passCount:0}),t[o].users.push(c)):i.users.push(c)}),Object.values(t).forEach(s=>{s.totalAttempts=s.users.reduce((o,c)=>o+c.attempts,0),s.averageScore=s.users.reduce((o,c)=>o+c.score,0)/s.users.length,s.highestScore=Math.max(...s.users.map(o=>o.score)),s.averageTimeTaken=s.users.reduce((o,c)=>o+c.timeTaken,0)/s.users.length,s.totalCorrectAnswers=s.users.reduce((o,c)=>o+c.correctAnswers,0),s.totalQuestions=s.users.reduce((o,c)=>o+c.totalQuestions,0),s.passCount=s.users.filter(o=>o.isPassed).length}),i.users.length>0&&(i.totalAttempts=i.users.reduce((s,o)=>s+o.attempts,0),i.averageScore=i.users.reduce((s,o)=>s+o.score,0)/i.users.length,i.highestScore=Math.max(...i.users.map(s=>s.score)),i.averageTimeTaken=i.users.reduce((s,o)=>s+o.timeTaken,0)/i.users.length,i.totalCorrectAnswers=i.users.reduce((s,o)=>s+o.correctAnswers,0),i.totalQuestions=i.users.reduce((s,o)=>s+o.totalQuestions,0),i.passCount=i.users.filter(s=>s.isPassed).length),[...Object.values(t),...i.users.length>0?[i]:[]]}),N=k(()=>{if(!d.value||!p.value)return[];const a=p.value.find(t=>t.questionSet_id===d.value);return(a==null?void 0:a.submissions)||[]});function F(a){d.value=a.value}const I=k(()=>N.value?N.value.filter(a=>a.fullName.toLowerCase().includes(f.value.toLowerCase())||a.email.toLowerCase().includes(f.value.toLowerCase())):[]),L=k(()=>{var a;return(a=p.value)==null?void 0:a.map(t=>({label:t.questionSetName,value:t.questionSet_id}))});function E(a){return new Date(a).toLocaleDateString("vi-VN",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}function G(a){const t=Math.floor(a/60),i=a%60;return`${t}:${i.toString().padStart(2,"0")}`}const j=a=>(a/10).toFixed(2);return O(async()=>{U(),Q()}),(a,t)=>{const i=b("GenericSelect"),s=b("GenericInput"),o=b("ConfirmDialog"),c=b("InstructorLayout"),M=b("FullScreenLoading");return u(),n(C,null,[y(c,null,{default:P(()=>{var q;return[e("div",J,[e("div",W,[e("div",X,[e("div",Y,[t[10]||(t[10]=e("label",{for:"course",class:"block text-sm font-medium text-gray-700 mb-1"},"Chọn khóa học",-1)),y(i,{id:"course",modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=l=>w.value=l),onChange:z,options:V.value,class:"w-full border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:m.value},null,8,["modelValue","options","disabled"])])])]),e("div",Z,[e("div",ee,[e("div",te,[e("button",{onClick:t[1]||(t[1]=l=>_("list")),class:S(["px-4 py-2 rounded-lg transition-colors",g.value==="list"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," Bài kiểm tra theo khóa học ",2),e("button",{onClick:t[2]||(t[2]=l=>_("form")),class:S(["px-4 py-2 rounded-lg transition-colors",g.value==="form"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," Bài kiểm tra của học viên ",2),e("button",{onClick:t[3]||(t[3]=l=>_("bulk")),class:S(["px-4 py-2 rounded-lg transition-colors",g.value==="bulk"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," Bài kiểm tra theo phòng ban ",2)]),g.value==="list"?(u(),n("button",{key:0,onClick:t[4]||(t[4]=l=>_("form")),class:"flex items-center px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",disabled:m.value},t[11]||(t[11]=[e("i",{class:"bi bi-plus text-lg mr-2"},null,-1),x(" Thêm câu hỏi ")]),8,se)):v("",!0)])]),g.value==="list"?(u(),n("div",le,[e("div",ae,[t[13]||(t[13]=e("h2",{class:"text-2xl font-semibold"},"Thống kê bài kiểm tra",-1)),e("div",oe,[t[12]||(t[12]=e("i",{class:"bi bi-search absolute left-3 top-2.5 text-gray-500"},null,-1)),y(s,{modelValue:f.value,"onUpdate:modelValue":t[5]||(t[5]=l=>f.value=l),type:"text",placeholder:"Tìm kiếm câu hỏi...",class:"w-full pl-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,["modelValue"])])]),(q=p.value)!=null&&q.length?(u(),n("div",re,[e("div",ne,[e("table",ue,[t[15]||(t[15]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tên bài kiểm tra "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Điểm trung bình "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Điểm cao nhất "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Điểm thấp nhất "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tỉ lệ tham gia "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tỉ lệ qua ")])],-1)),e("tbody",ce,[(u(!0),n(C,null,T(p.value,l=>(u(),n("tr",{key:l.id,class:"hover:bg-gray-50"},[e("td",de,r(l.questionSetName),1),e("td",pe,r((l.averageScore/10).toFixed(2)),1),e("td",xe,r((l.highestScore/10).toFixed(2)),1),e("td",ge,r((l.lowestScore/10).toFixed(2)),1),e("td",me,r(l.participationRate),1),e("td",he,r(l.passingRate),1)]))),128))])])])])):(u(),n("div",ie,t[14]||(t[14]=[e("i",{class:"bi bi-inbox text-4xl text-gray-400"},null,-1),e("p",{class:"mt-2 text-gray-600"},"Vui lòng chọn khóa học",-1)])))])):v("",!0),g.value==="form"?(u(),n("div",ye,[e("div",fe,[t[19]||(t[19]=e("h2",{class:"text-2xl font-semibold"},"Kết quả bài kiểm tra của học viên",-1)),e("div",be,[e("div",ve,[t[16]||(t[16]=e("label",{for:"quiz",class:"block text-sm font-medium text-gray-700 mb-1"},"Chọn bài kiểm tra",-1)),y(i,{id:"quiz",modelValue:d.value,"onUpdate:modelValue":t[6]||(t[6]=l=>d.value=l),onChange:F,options:L.value,class:"w-full border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:m.value},null,8,["modelValue","options","disabled"])]),e("div",we,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tìm kiếm",-1)),e("div",_e,[t[17]||(t[17]=e("i",{class:"bi bi-search absolute left-3 top-2.5 text-gray-500"},null,-1)),y(s,{modelValue:f.value,"onUpdate:modelValue":t[7]||(t[7]=l=>f.value=l),type:"text",placeholder:"Tìm kiếm học viên...",class:"w-full pl-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,["modelValue"])])])])]),d.value?I.value.length>0?(u(),n("div",Ce,[e("table",Se,[t[21]||(t[21]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Học viên"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Email"),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Điểm cao nhất "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Điểm gần nhất "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Số câu đúng "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Thời gian làm "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Lần làm gần nhất "),e("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Số lần làm ")])],-1)),e("tbody",Te,[(u(!0),n(C,null,T(I.value,l=>(u(),n("tr",{key:l.userId,class:"hover:bg-gray-50"},[e("td",Ve,[e("div",Ae,[e("span",null,r(l.fullName),1)])]),e("td",Qe,r(l.email),1),e("td",De,r((l.highestScore/10).toFixed(2)),1),e("td",Ne,r((l.latestScore/10).toFixed(2)),1),e("td",Fe,r(l.countCorrected)+"/"+r(l.totalAnswers),1),e("td",Ie,r(G(l.timeTaken)),1),e("td",Le,r(E(l.lastAttempt)),1),e("td",Ge,r(l.attemptCount),1)]))),128))])])])):(u(),n("div",je,t[22]||(t[22]=[e("i",{class:"bi bi-inbox text-4xl text-gray-400"},null,-1),e("p",{class:"mt-2 text-gray-600"},"Không tìm thấy kết quả",-1)]))):(u(),n("div",ke,t[20]||(t[20]=[e("i",{class:"bi bi-inbox text-4xl text-gray-400"},null,-1),e("p",{class:"mt-2 text-gray-600"},"Vui lòng chọn bài kiểm tra",-1)])))])):v("",!0),g.value==="bulk"?(u(),n("div",qe,[e("div",Be,[t[24]||(t[24]=e("h2",{class:"text-2xl font-semibold flex items-center"},[e("i",{class:"bi bi-building mr-2"}),x(" Thống kê bài kiểm tra theo phòng ban ")],-1)),e("div",Re,[t[23]||(t[23]=e("label",{for:"roomQuiz",class:"block text-sm font-medium text-gray-700 mb-1"},"Chọn bài kiểm tra",-1)),y(i,{id:"roomQuiz",modelValue:d.value,"onUpdate:modelValue":t[8]||(t[8]=l=>d.value=l),onChange:F,options:L.value,class:"w-full border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:m.value},null,8,["modelValue","options","disabled"])])]),e("div",$e,[e("table",Ue,[t[26]||(t[26]=e("thead",{class:"bg-gray-50"},[e("tr",null,[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("i",{class:"bi bi-building-fill mr-1"}),x("Phòng ban ")]),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("i",{class:"bi bi-people-fill mr-1"}),x("Số người ")]),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("i",{class:"bi bi-arrow-repeat mr-1"}),x("Tổng số lần làm ")]),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("i",{class:"bi bi-star-fill mr-1"}),x("Điểm trung bình ")]),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("i",{class:"bi bi-trophy-fill mr-1"}),x("Điểm cao nhất ")]),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("i",{class:"bi bi-clock-fill mr-1"}),x("Thời gian trung bình ")]),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("i",{class:"bi bi-check-circle-fill mr-1"}),x("Tỷ lệ đúng ")]),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},[e("i",{class:"bi bi-award-fill mr-1"}),x("Tỷ lệ qua ")])])],-1)),e("tbody",ze,[(u(!0),n(C,null,T(D.value,l=>(u(),n("tr",{key:l.roomId,class:"hover:bg-gray-50"},[e("td",Ee,[e("div",Me,[t[25]||(t[25]=e("i",{class:"bi bi-building text-gray-500 mr-2"},null,-1)),e("span",Oe,r(l.roomName),1)])]),e("td",Pe,r(l.users.length),1),e("td",Ke,r(l.totalAttempts),1),e("td",He,r(j(l.averageScore)),1),e("td",Je,r(j(l.highestScore)),1),e("td",We,r(G(Math.round(l.averageTimeTaken))),1),e("td",Xe,r((l.totalCorrectAnswers/l.totalQuestions*100).toFixed(1))+"% ",1),e("td",Ye,r((l.passCount/l.users.length*100).toFixed(1))+"% ",1)]))),128))])]),D.value.length===0?(u(),n("div",Ze,t[27]||(t[27]=[e("i",{class:"bi bi-inbox text-4xl text-gray-400"},null,-1),e("p",{class:"mt-2 text-gray-600"},"Không có dữ liệu thống kê",-1)]))):v("",!0)])])):v("",!0),y(o,{modelValue:A.value,"onUpdate:modelValue":t[9]||(t[9]=l=>A.value=l),onAccept:a.handleAceptDeleteCourse,onDeny:a.handleDenyDeleteCourse},null,8,["modelValue","onAccept","onDeny"])])]}),_:1}),y(M,{open:m.value},null,8,["open"])],64)}}};export{at as default};
