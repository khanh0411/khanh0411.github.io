import{r,i as F,e as Ve,c as n,k as x,l as Ae,F as M,E as d,j as k,o as a,a as t,z as c,T as C,D as u,b as S,x as ne,Y as De,q as X,H as je,u as ae,a2 as re,C as Ue,W as Fe,c7 as Le}from"./index-3TT_0WAL.js";import{u as $e}from"./question.store-swwE8Fd0.js";import{u as Be}from"./studentCourse.store-DycZazWx.js";import{r as Ee,u as N,w as Ge}from"./xlsx-uoQkVabA.js";const Ie={class:"max-w-6xl mx-auto p-6"},Me={class:"mb-6"},Ne={class:"flex justify-between items-center"},Qe={key:0,class:"relative w-64"},qe={class:"mb-6"},ze={class:"flex justify-between items-center"},He={class:"flex space-x-2"},Re=["disabled"],Oe={key:0,class:"mb-4 p-4 bg-red-100 text-red-700 rounded-lg flex justify-between items-center"},Ke={class:"flex items-center"},We={key:1,class:"bg-white rounded-lg shadow-lg p-6"},Xe={class:"flex justify-between items-center mb-6"},Ye={class:"flex items-center space-x-4"},Je={class:"relative"},Pe={class:"relative w-64"},Ze={key:0,class:"py-8 text-center"},et={key:1,class:"overflow-x-auto"},tt={class:"min-w-full"},st={class:"bg-white divide-y divide-gray-200"},lt={class:"px-6 py-4 font-medium"},ot={class:"px-6 py-4"},nt={class:"px-6 py-4"},at={class:"px-6 py-4"},rt={class:"flex items-center"},it={class:"w-full bg-gray-200 rounded-full h-2.5"},ut={class:"ml-2 text-sm text-gray-600"},dt={class:"px-6 py-4"},ct={class:"px-6 py-4"},vt={class:"flex space-x-2"},bt=["onClick","disabled"],pt={key:2,class:"bg-white rounded-lg shadow-lg p-6"},mt={class:"text-2xl font-semibold mb-6"},xt={class:"space-y-6"},gt={class:"flex space-x-4"},ft=["disabled"],ht={key:0,class:"flex items-center justify-center"},yt={key:1},_t=["disabled"],wt={key:0,class:"flex items-center justify-center"},kt={key:1},Ct=["disabled"],St={key:3,class:"bg-white rounded-lg shadow-lg p-6"},Tt={key:0,class:"py-8 text-center"},Vt={key:1,class:"space-y-4"},At={class:"flex justify-between items-start"},Dt={class:"flex-grow"},jt={class:"flex items-center space-x-2 mb-2"},Ut={class:"font-medium"},Ft={class:"text-sm text-gray-500"},Lt={class:"text-gray-800 mb-2"},$t=["onClick"],Bt={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Et={class:"bg-white rounded-lg p-6 w-full max-w-lg"},Gt={class:"mb-4"},It={class:"text-gray-600 mb-2"},Mt={class:"text-gray-800 p-3 bg-gray-50 rounded"},Nt={class:"mb-4"},Qt={class:"flex justify-end space-x-3"},qt=["disabled"],zt={key:0,class:"flex items-center justify-center"},Ht={key:1},Rt={key:4,class:"bg-white rounded-lg shadow-lg p-6"},Ot={class:"mb-6"},Kt={class:"mb-6"},Wt={class:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center"},Xt={class:"flex flex-col items-center"},Yt={class:"flex space-x-4"},Jt=["disabled"],Pt={key:0,class:"mt-4 text-left"},Zt={class:"flex items-center justify-between p-2 bg-gray-50 rounded"},es={class:"flex items-center"},ts={class:"text-gray-700"},ss={key:0,class:"mb-6"},ls={class:"text-lg font-medium mb-3"},os={class:"max-h-60 overflow-y-auto border rounded-lg"},ns={class:"grid grid-cols-2 gap-4 p-4"},as={class:"flex justify-end space-x-4"},rs=["disabled"],is=["disabled"],us={key:0,class:"flex items-center"},ds={key:1},gs={__name:"InstructorUser",setup(cs){const ie=$e(),p=Be(),Q=r(null),q=r(null),T=r(null),m=r(null),Y=r(null),z=r(""),y=r(""),i=r("list"),L=r([]),H=r([]),J=r([]),$=r([]),V=r(!1),o=r(!1),A=r(!1),B=r(!1),E=r("all"),v=r({email:"",course:""}),P=F(()=>Array.isArray(L.value)?L.value.filter(s=>{var f;const e=(f=s.user)==null?void 0:f.full_name.toLowerCase().includes(z.value.toLowerCase()),g=E.value==="all"?!0:E.value==="added"?s.isAdd===1:s.isAdd===2;return e&&g}):[]),Z=F(()=>Array.isArray(H.value)?H.value.filter(s=>m.value?s.course_id===m.value:!0):[]),ee=F(()=>v.value.email.trim()!==""&&v.value.course.trim()!==""),te=F(()=>y.value.trim().length>0);function D(s){o.value||(i.value=s),i.value==="list"&&(m.value="",_()),i.value==="questions"&&R(),i.value==="form"&&fe()}async function R(){o.value=!0;const s=m.value,e=await p.handleTeacherGetQuestions(s);o.value=!1,e.error?d({text:e.errors,type:"error"}):H.value=e.data}function ue(s){T.value=s,B.value=!0,y.value=""}async function de(s){if(!te.value)return;o.value=!0;const e=await p.handleTeacherReply({id_message:T.value._id,message:s});o.value=!1,e.error?d({text:e.errors,type:"error"}):(d({text:"Đã trả lời câu hỏi thành công",type:"success"}),B.value=!1,T.value=null,y.value="",R())}function ce(s){A.value=!0,q.value=s}async function ve(){o.value=!0;const s=await p.handleDeleteStudentInCourse(q.value.id);o.value=!1,s.errors?d({text:s.errors,type:"error"}):(A.value=!1,d({text:"Delete success   ",type:"success"}),_())}function be(){A.value=!1,q.value=null}function G(){v.value={email:"",course:""},V.value=!1,Y.value=null,i.value="list"}async function pe(){o.value=!0;const s=await p.handleUpdateStudent({...v.value,student_id:Y.value});o.value=!1,s.errors?d({text:s.errors,type:"error"}):(d({text:"Update Success",type:"success"}),G(),_())}async function me(){o.value=!0;const s={course_id:v.value.course,query:v.value.email},e=await p.handleAddStudentByCourse(s);o.value=!1,e.errors?d({text:e.errors,type:"error"}):(d({text:"Create Success",type:"success"}),G(),_())}async function xe(){o.value=!0;const s=await ie.handleGetCourseById();o.value=!1,s.errors?d({text:s.errors,type:"error"}):$.value=s}function ge(s){m.value=s.value,i.value==="list"&&_(),i.value==="questions"&&R()}async function _(){o.value=!0;const s=await p.handleGetListStudentCourse(m.value);o.value=!1,s.errors?d({text:s.errors,type:"error"}):L.value=s.data}async function fe(){o.value=!0;const s=await p.handleGetListUser();o.value=!1,L.value=s,s.errors?d({text:s.errors,type:"error"}):J.value=s.map(e=>new Le(e.user_id,e.email))}const j=r(null),b=r([]),w=r(""),he=F(()=>w.value&&b.value.length>0),ye=s=>{const e=s.target.files[0];e&&(j.value=e,_e(e))},_e=s=>{const e=new FileReader;e.onload=g=>{try{const f=new Uint8Array(g.target.result),I=Ee(f,{type:"array"}),O=I.SheetNames[0],K=I.Sheets[O],W=N.sheet_to_json(K,{header:1});b.value=W.slice(1).map(h=>h[0]).filter(h=>h&&we(h))}catch{d({text:"Lỗi khi đọc file Excel. Vui lòng kiểm tra định dạng file.",type:"error"})}},e.readAsArrayBuffer(s)},we=s=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s),ke=()=>{j.value=null,b.value=[]},Ce=()=>{const s=N.book_new(),e=N.aoa_to_sheet([["Email"],["example1@email.com"],["example2@email.com"]]);N.book_append_sheet(s,e,"Template"),Ge(s,"student_template.xlsx")},Se=async()=>{if(!(!w.value||b.value.length===0)){o.value=!0;try{const s=await p.handleAddStudentByCourse2({course_id:w.value,listUser:b.value});s.errors?d({text:s.errors,type:"error"}):(d({text:"Thêm học viên thành công",type:"success"}),Te())}catch(s){d({text:s.message,type:"error"})}finally{o.value=!1}}},Te=()=>{j.value=null,b.value=[],w.value=""};return Ve(()=>{_(),xe()}),(s,e)=>{const g=k("GenericSelect"),f=k("GenericInput"),I=k("MultipleSelect"),O=k("ConfirmDialog"),K=k("InstructorLayout"),W=k("FullScreenLoading");return a(),n(M,null,[x(K,null,{default:Ae(()=>{var h,se,le,oe;return[t("div",Ie,[t("div",Me,[t("div",Ne,[i.value==="list"||i.value==="questions"?(a(),n("div",Qe,[e[17]||(e[17]=t("label",{for:"course",class:"block text-sm font-medium text-gray-700 mb-1"},"Chọn khóa học",-1)),x(g,{id:"course",modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=l=>m.value=l),onChange:ge,options:$.value,class:"w-full border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:o.value},null,8,["modelValue","options","disabled"])])):c("",!0)])]),t("div",qe,[t("div",ze,[t("div",He,[t("button",{onClick:e[1]||(e[1]=l=>D("list")),class:C(["px-4 py-2 rounded-lg transition-colors",i.value==="list"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," Danh sách học viên ",2),t("button",{onClick:e[2]||(e[2]=l=>D("questions")),class:C(["px-4 py-2 rounded-lg transition-colors",i.value==="questions"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," Câu hỏi của học viên ",2),t("button",{onClick:e[3]||(e[3]=l=>D("form")),class:C(["px-4 py-2 rounded-lg transition-colors",i.value==="form"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])},u(V.value?"Chỉnh sửa học viên":"Thêm học viên mới"),3),t("button",{onClick:e[4]||(e[4]=l=>D("students")),class:C(["px-4 py-2 rounded-lg transition-colors",i.value==="students"?"bg-blue-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"])}," Thêm nhiều học viên ",2)]),i.value==="list"?(a(),n("button",{key:0,onClick:e[5]||(e[5]=l=>D("form")),class:"flex items-center px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors",disabled:o.value},e[18]||(e[18]=[t("i",{class:"bi bi-plus text-lg mr-2"},null,-1),S(" Thêm học viên ")]),8,Re)):c("",!0)])]),Q.value?(a(),n("div",Oe,[t("div",Ke,[e[19]||(e[19]=t("i",{class:"bi bi-exclamation-circle mr-2"},null,-1)),S(" "+u(Q.value),1)]),t("button",{onClick:e[6]||(e[6]=l=>Q.value=null),class:"text-red-700 hover:text-red-900"},e[20]||(e[20]=[t("i",{class:"bi bi-x-lg"},null,-1)]))])):c("",!0),i.value==="list"?(a(),n("div",We,[t("div",Xe,[e[23]||(e[23]=t("h2",{class:"text-2xl font-semibold"},"Danh sách học viên",-1)),t("div",Ye,[t("div",Je,[ne(t("select",{"onUpdate:modelValue":e[7]||(e[7]=l=>E.value=l),class:"px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},e[21]||(e[21]=[t("option",{value:"all"},"Tất cả học viên",-1),t("option",{value:"added"},"Được thêm bởi giáo viên",-1),t("option",{value:"purchased"},"Tự đăng ký",-1)]),512),[[De,E.value]])]),t("div",Pe,[e[22]||(e[22]=t("i",{class:"bi bi-search absolute left-3 top-2.5 text-gray-500"},null,-1)),x(f,{modelValue:z.value,"onUpdate:modelValue":e[8]||(e[8]=l=>z.value=l),type:"text",placeholder:"Tìm kiếm học viên...",class:"w-full pl-10 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},null,8,["modelValue"])])])]),(h=P.value)!=null&&h.length?(a(),n("div",et,[t("table",tt,[e[26]||(e[26]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Mã học viên "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"}," Tên học viên "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-36"}," Loại đăng ký "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-36"}," Tiến độ "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Tham gia"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Thao tác")])],-1)),t("tbody",st,[(a(!0),n(M,null,X(P.value,l=>(a(),n("tr",{key:l.user._id,class:"hover:bg-gray-50"},[t("td",lt,u(l.user.code),1),t("td",ot,u(l.user.full_name),1),t("td",nt,[t("span",{class:C(["px-2 py-1 text-xs rounded-full",l.isAdd===1?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800"])},u(l.isAdd===1?"Được thêm":"Tự đăng ký"),3)]),t("td",at,[t("div",rt,[t("div",it,[t("div",{class:"bg-blue-600 h-2.5 rounded-full",style:je({width:`${l.progress}%`})},null,4)]),t("span",ut,u(l.progress)+"%",1)])]),t("td",dt,u(ae(re)(l.joinAt)),1),t("td",ct,[t("div",vt,[t("button",{onClick:U=>ce(l),class:"p-2 ml-5 text-red-600 hover:bg-red-100 rounded-lg transition-colors",disabled:o.value},e[25]||(e[25]=[t("i",{class:"bi bi-trash"},null,-1)]),8,bt)])])]))),128))])])])):(a(),n("div",Ze,e[24]||(e[24]=[t("i",{class:"bi bi-inbox text-4xl text-gray-400"},null,-1),t("p",{class:"mt-2 text-gray-600"},"Vui lòng chọn khóa học",-1)])))])):c("",!0),i.value==="form"?(a(),n("div",pt,[t("h2",mt,u(V.value?"Chỉnh sửa học viên":"Thêm học viên mới"),1),t("div",xt,[t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Email học viên",-1)),x(I,{modelValue:v.value.email,"onUpdate:modelValue":e[9]||(e[9]=l=>v.value.email=l),options:J.value},null,8,["modelValue","options"])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Khóa học",-1)),x(g,{modelValue:v.value.course,"onUpdate:modelValue":e[10]||(e[10]=l=>v.value.course=l),options:$.value,class:"w-full",required:"",disabled:o.value},null,8,["modelValue","options","disabled"])]),t("div",gt,[V.value?c("",!0):(a(),n("button",{key:0,onClick:me,type:"submit",class:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50",disabled:o.value||!ee.value},[o.value?(a(),n("span",ht,e[29]||(e[29]=[t("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"},null,-1),S(" Đang xử lý... ")]))):(a(),n("span",yt,"Thêm học viên"))],8,ft)),V.value?(a(),n("button",{key:1,onClick:pe,type:"submit",class:"flex-1 px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:opacity-50",disabled:o.value||!ee.value},[o.value?(a(),n("span",wt,e[30]||(e[30]=[t("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"},null,-1),S(" Đang xử lý... ")]))):(a(),n("span",kt,"Cập nhật"))],8,_t)):c("",!0),t("button",{type:"button",onClick:G,class:"flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:o.value}," Hủy ",8,Ct)])])])):c("",!0),i.value==="questions"?(a(),n("div",St,[e[35]||(e[35]=t("h2",{class:"text-2xl font-semibold mb-6"},"Câu hỏi của học viên",-1)),Z.value.length?(a(),n("div",Vt,[(a(!0),n(M,null,X(Z.value,l=>{var U;return a(),n("div",{key:l.id,class:"border rounded-lg p-4 hover:bg-gray-50"},[t("div",At,[t("div",Dt,[t("div",jt,[t("span",Ut,u((U=l.sender)==null?void 0:U.full_name),1),t("span",Ft,u(ae(re)(l.timestamp)),1),t("span",{class:C(["px-2 py-1 text-xs rounded-full",l.isAnswered?"bg-green-100 text-green-800":"bg-yellow-100 text-yellow-800"])},u(l.isAnswered?"Đã trả lời":"Chưa trả lời"),3)]),t("p",Lt,u(l.message),1)]),l.answer?c("",!0):(a(),n("button",{key:0,onClick:vs=>ue(l),class:"px-3 py-1 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"}," Trả lời ",8,$t))])])}),128))])):(a(),n("div",Tt,e[31]||(e[31]=[t("i",{class:"bi bi-chat-left-dots text-4xl text-gray-400"},null,-1),t("p",{class:"mt-2 text-gray-600"},"Chưa có câu hỏi nào",-1)]))),B.value?(a(),n("div",Bt,[t("div",Et,[e[34]||(e[34]=t("h3",{class:"text-xl font-semibold mb-4"},"Trả lời câu hỏi",-1)),t("div",Gt,[t("p",It,"Câu hỏi từ "+u((se=T.value)==null?void 0:se.sender.full_name)+":",1),t("p",Mt,u((le=T.value)==null?void 0:le.message),1)]),t("div",Nt,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Câu trả lời",-1)),ne(t("textarea",{"onUpdate:modelValue":e[11]||(e[11]=l=>y.value=l),rows:"4",class:"w-full border rounded-lg p-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Nhập câu trả lời..."},null,512),[[Ue,y.value]])]),t("div",Qt,[t("button",{onClick:e[12]||(e[12]=l=>B.value=!1),class:"px-4 py-2 border rounded-lg hover:bg-gray-50"},"Hủy"),t("button",{onClick:e[13]||(e[13]=l=>de(y.value)),disabled:!te.value||o.value,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 disabled:opacity-50"},[o.value?(a(),n("span",zt,e[33]||(e[33]=[t("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"},null,-1),S(" Đang xử lý... ")]))):(a(),n("span",Ht,"Gửi câu trả lời"))],8,qt)])])])):c("",!0)])):c("",!0),i.value==="students"?(a(),n("div",Rt,[e[43]||(e[43]=t("h2",{class:"text-2xl font-semibold mb-6"},"Thêm nhiều học viên",-1)),t("div",Ot,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"Chọn khóa học",-1)),x(g,{modelValue:w.value,"onUpdate:modelValue":e[14]||(e[14]=l=>w.value=l),options:$.value,class:"w-full border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",disabled:o.value},null,8,["modelValue","options","disabled"])]),t("div",Kt,[t("div",Wt,[t("div",Xt,[e[37]||(e[37]=t("i",{class:"bi bi-file-earmark-excel text-4xl text-gray-400 mb-2"},null,-1)),e[38]||(e[38]=t("p",{class:"text-gray-600 mb-4"},"Tải lên file Excel chứa danh sách email học viên",-1)),t("input",{type:"file",ref:"fileInput",onChange:ye,accept:".xlsx,.xls",class:"hidden"},null,544),t("div",Yt,[t("button",{onClick:e[15]||(e[15]=l=>s.$refs.fileInput.click()),class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",disabled:o.value}," Chọn file ",8,Jt),t("a",{href:"#",onClick:Fe(Ce,["prevent"]),class:"px-4 py-2 text-blue-500 border border-blue-500 rounded-lg hover:bg-blue-50 transition-colors"}," Tải mẫu Excel ")])]),j.value?(a(),n("div",Pt,[t("div",Zt,[t("div",es,[e[39]||(e[39]=t("i",{class:"bi bi-file-earmark-text text-gray-500 mr-2"},null,-1)),t("span",ts,u(j.value.name),1)]),t("button",{onClick:ke,class:"text-red-500 hover:text-red-700"},e[40]||(e[40]=[t("i",{class:"bi bi-x-lg"},null,-1)]))])])):c("",!0)])]),b.value.length?(a(),n("div",ss,[t("h3",ls,"Danh sách email ("+u((oe=b.value)==null?void 0:oe.length)+")",1),t("div",os,[t("div",ns,[(a(!0),n(M,null,X(b.value,(l,U)=>(a(),n("div",{key:U,class:"flex items-center"},[e[41]||(e[41]=t("i",{class:"bi bi-envelope text-gray-400 mr-2"},null,-1)),t("span",null,u(l),1)]))),128))])])])):c("",!0),t("div",as,[t("button",{onClick:G,class:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",disabled:o.value}," Hủy ",8,rs),t("button",{onClick:Se,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors",disabled:o.value||!he.value},[o.value?(a(),n("span",us,e[42]||(e[42]=[t("div",{class:"animate-spin rounded-full h-5 w-5 border-2 border-white border-t-transparent mr-2"},null,-1),S(" Đang xử lý... ")]))):(a(),n("span",ds,"Thêm học viên"))],8,is)])])):c("",!0),x(O,{modelValue:A.value,"onUpdate:modelValue":e[16]||(e[16]=l=>A.value=l),onAccept:ve,onDeny:be,title:"Xác nhận xóa",message:"Bạn có chắc chắn muốn xóa học viên này không?",isLoading:o.value},null,8,["modelValue","isLoading"])])]}),_:1}),x(W,{open:o.value},null,8,["open"])],64)}}};export{gs as default};
